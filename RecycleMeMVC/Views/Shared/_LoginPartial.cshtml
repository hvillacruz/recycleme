@using Microsoft.AspNet.Identity

@if (Request.IsAuthenticated)
{
    using (Html.BeginForm("LogOff", "Account", FormMethod.Post, new { id = "logoutForm" }))
    {
        @Html.AntiForgeryToken()

        <div id="loginPartialDiv" data-bind="foreach: Login">

            <ul class="nav ace-nav">


                <li class="grey">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                        <i class="ace-icon fa fa-bell icon-animated-bell"></i>
                        <span class="badge badge-important">8</span>
                    </a>

                    <ul class="dropdown-menu-right dropdown-navbar navbar-grey dropdown-menu dropdown-caret dropdown-close">
                        <li class="dropdown-header">
                            <i class="ace-icon fa fa-exclamation-triangle"></i>
                            8 Notifications
                        </li>

                        <li>
                            <a href="#">
                                <div class="clearfix">
                                    <span class="pull-left">
                                        <i class="btn btn-xs no-hover btn-pink fa fa-comment"></i>
                                        New Comments
                                    </span>
                                    <span class="pull-right badge badge-info">+12</span>
                                </div>
                            </a>
                        </li>

                        <li>
                            <a href="#">
                                <i class="btn btn-xs btn-primary fa fa-user"></i>
                                Bob just signed up as an editor ...
                            </a>
                        </li>

                        <li>
                            <a href="#">
                                <div class="clearfix">
                                    <span class="pull-left">
                                        <i class="btn btn-xs no-hover btn-success fa fa-shopping-cart"></i>
                                        New Orders
                                    </span>
                                    <span class="pull-right badge badge-success">+8</span>
                                </div>
                            </a>
                        </li>

                        <li>
                            <a href="#">
                                <div class="clearfix">
                                    <span class="pull-left">
                                        <i class="btn btn-xs no-hover btn-info fa fa-twitter"></i>
                                        Followers
                                    </span>
                                    <span class="pull-right badge badge-info">+11</span>
                                </div>
                            </a>
                        </li>

                        <li class="dropdown-footer">
                            <a href="#">
                                See all notifications
                                <i class="ace-icon fa fa-arrow-right"></i>
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="green">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                        <i class="ace-icon fa fa-envelope icon-animated-vertical"></i>
                        <span class="badge badge-success"><span data-bind="text: $root.MessageCount"></span></span>
                    </a>

                    <ul class="dropdown-menu-right dropdown-navbar dropdown-menu dropdown-caret dropdown-close" data-bind="foreach: $root.Message">

                        <!-- ko if: $index() < 1 -->
                        <li class="dropdown-header">
                            <i class="ace-icon fa fa-envelope-o"></i>
                            <span data-bind="text: $root.MessageCount"></span>  Messages
                        </li>
                        <!-- /ko -->
                        <li>
                            <a href="#">
                                <img class="nav-user-photo img-circle" data-bind="attr:{src: Sender.Avatar}" src="/Content/Assets/images/avatar.jpg" alt="Alex's Avatar" />
                                <span class="msg-body">
                                    <span class="msg-title">
                                        <span class="blue" data-bind="text:Sender.FirstName"></span>
                                        <span data-bind="text:Subject"></span>
                                    </span>

                                    <span class="msg-time">
                                        <i class="ace-icon fa fa-clock-o"></i>
                                        <span data-bind="text:Time"></span>
                                    </span>
                                </span>
                            </a>
                        </li>

                        <li class="dropdown-footer">
                            <!-- ko if: $index() > 1 -->
                            <a href="@Url.Action("Message", "Profile")">
                                See all messages
                                <i class="ace-icon fa fa-arrow-right"></i>
                            </a>
                            <!-- /ko -->
                        </li>

                    </ul>
                </li>

                <li class="light-yellow">
                    <a data-toggle="dropdown" class="dropdown-toggle">
                        <div class="avatar-face">
                            <div class="img-circle">
                                <img class="nav-user-photo" data-bind="attr:{src: Avatar}" src="/Content/Assets/images/avatar.jpg" alt=@User.Identity.GetUserName() />
                                <span class="user-info">

                                    @User.Identity.GetUserName()
                                </span>
                                <i class="fa fa-caret-down browndirt"></i>
                            </div>
                        </div>
                    </a>
                    <ul class="user-menu pull-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">
                        <li>
                            <a href="@Url.Action("", "")">
                                <i class="fa fa-cog"></i>
                                Settings
                            </a>
                        </li>

                        <li>
                            <a href="@Url.Action("Dashboard", "Profile")">

                                <i class="fa fa-user"></i>
                                Profile
                            </a>

                        </li>

                        <li>
                            <a href="@Url.Action("Message", "Profile")">
                                <i class="fa fa-envelope"></i>
                                Message
                            </a>

                        </li>




                        <li class="divider"></li>

                        <li id="logoutBtn" class="logout">
                            <a href="#">
                                <i class="fa fa-power-off"></i>
                                Logout
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    }


    @Scripts.Render("~/bundles/header")
    <script>
        var global = new GlobalViewModel();
        global.User("@User.Identity.GetUserId()", "@User.Identity.GetUserName()")
        ko.applyBindings(global, document.getElementById("loginPartialDiv"));
        global.GetMessage();
        global.Profile();
    </script>
}
else
{

    <ul class="nav navbar-nav navbar-right col-md-12  hidden-xs">
        <li>@Html.ActionLink("Register", "Register", "Account", routeValues: null, htmlAttributes: new { id = "registerLink" })</li>
        <li>@Html.ActionLink("Log in", "Login", "Account", routeValues: null, htmlAttributes: new { id = "loginLink" })</li>
    </ul>
}
